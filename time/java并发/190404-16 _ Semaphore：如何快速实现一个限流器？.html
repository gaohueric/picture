<head>
    <meta charset="utf-8">
    <meta name="Keywords" content="极客时间,极客邦,极客邦科技,极客邦控股,极客时间App,专栏订阅,极客新闻,二叉树,极客Live,QCon,左耳听风,AI技术内参,大航海时代,陈皓,徐飞,洪亮劼,霍泰稳,池建强,Selina,Gary,InfoQ,极客搜索">
    <meta name="description" content="极客时间是极客邦科技出品的一款 IT 内容知识服务 App，内容包含专栏订阅、极客新闻、热点专题、直播、视频和音频等多形式的知识内容，并设有陈皓专栏、徐飞专栏、洪亮劼专栏等专栏供订阅。">
    <link rel="apple-touch-icon" sizes="180x180" href="//static001.geekbang.org/static/icon/time/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="//static001.geekbang.org/static/icon/time/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="//static001.geekbang.org/static/icon/time/favicon-16x16.png">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no,viewport-fit=cover">
    <meta name="format-detection" content="telephone=no">
    <title>16 | Semaphore：如何快速实现一个限流器？</title>

    <link href="https://static001.geekbang.org/static/time/css/app.3e04e644962ca8c2f97ec7731bb7710c.css" rel="stylesheet">
    <style type="text/css">.hljs-ln {
        border-collapse: collapse
    }

    .hljs-ln td {
        padding: 0
    }

    .hljs-ln-n:before {
        content: attr(data-line-number)
    }</style>
    <style type="text/css">#iv-container {
        position: fixed;
        background: #0d0d0d;
        width: 100%;
        height: 100%;
        top: 0;
        left: 0;
        display: none;
        z-index: 1000
    }

    .iv-container {
        overflow: hidden
    }

    .iv-close {
        width: 26px;
        height: 26px;
        position: absolute;
        right: 20px;
        top: 20px;
        cursor: pointer;
        text-align: center;
        overflow: hidden;
        text-shadow: 0 0 3px #6d6d6d;
        -webkit-transition: all .2s ease;
        -moz-transition: all ease .2s;
        -o-transition: all ease .2s;
        transition: all .2s ease
    }

    .iv-close:after, .iv-close:before {
        content: "";
        height: 2px;
        width: 26px;
        background: #fff;
        position: absolute;
        left: 0;
        top: 50%;
        margin-top: -2px;
        border-radius: 2px
    }

    .iv-close:before {
        -webkit-transform: rotate(45deg);
        -moz-transform: rotate(45deg);
        -ms-transform: rotate(45deg);
        -o-transform: rotate(45deg);
        transform: rotate(45deg)
    }

    .iv-close:after {
        -webkit-transform: rotate(-45deg);
        -moz-transform: rotate(-45deg);
        -ms-transform: rotate(-45deg);
        -o-transform: rotate(-45deg);
        transform: rotate(-45deg)
    }

    .iv-close:hover {
        -webkit-transform: rotate(90deg);
        -moz-transform: rotate(90deg);
        -ms-transform: rotate(90deg);
        -o-transform: rotate(90deg);
        transform: rotate(90deg)
    }

    .iv-image-view {
        position: absolute;
        height: 100%;
        width: 100%
    }

    .iv-image-wrap {
        display: inline-block
    }

    .iv-image-wrap:active {
        cursor: move
    }

    .iv-large-image {
        cursor: move;
        max-width: 100%;
        max-height: 100%;
        background-color: #ececec;
        -moz-transform: translateZ(0);
        -o-transform: translateZ(0)
    }

    .iv-large-image, .iv-loader {
        position: absolute;
        -webkit-transform: translateZ(0);
        -ms-transform: translateZ(0);
        transform: translateZ(0)
    }

    .iv-loader {
        top: 50%;
        left: 50%;
        border-radius: 50%;
        width: 32px;
        height: 32px;
        z-index: 100;
        margin-top: -16px;
        margin-left: -16px;
        font-size: 5px;
        text-indent: -9999em;
        border-top: 1em solid hsla(0, 0%, 100%, .2);
        border-right: 1em solid hsla(0, 0%, 100%, .2);
        border-bottom: 1em solid hsla(0, 0%, 100%, .2);
        border-left: 1em solid #fff;
        -webkit-animation: load8 1.1s infinite linear;
        animation: load8 1.1s infinite linear
    }

    .iv-loader:after {
        width: 10em;
        height: 10em;
        border-radius: 50%
    }

    @-webkit-keyframes load8 {
        0% {
            -webkit-transform: rotate(0deg);
            transform: rotate(0deg)
        }
        to {
            -webkit-transform: rotate(1turn);
            transform: rotate(1turn)
        }
    }

    @keyframes load8 {
        0% {
            -webkit-transform: rotate(0deg);
            transform: rotate(0deg)
        }
        to {
            -webkit-transform: rotate(1turn);
            transform: rotate(1turn)
        }
    }</style>
    <style type="text/css">.vue-pull-to-wrapper[data-v-12abd9fb] {
        display: -webkit-box;
        display: -webkit-flex;
        display: flex;
        -webkit-box-orient: vertical;
        -webkit-box-direction: normal;
        -webkit-flex-direction: column;
        flex-direction: column;
        height: 100%
    }

    .scroll-container[data-v-12abd9fb] {
        -webkit-box-flex: 1;
        -webkit-flex: 1;
        flex: 1;
        overflow-y: auto;
        -webkit-overflow-scrolling: touch
    }

    .vue-pull-to-wrapper .action-block[data-v-12abd9fb] {
        position: relative;
        width: 100%
    }

    .default-text[data-v-12abd9fb] {
        height: 100%;
        line-height: 50px;
        text-align: center
    }</style>
    <style type="text/css">.button-cancel[data-v-87ffcada] {
        color: #888;
        border: 1px solid #888;
        border-radius: 3px;
        margin-right: 12px
    }

    .button-cancel[data-v-87ffcada], .button-primary[data-v-87ffcada] {
        -webkit-box-flex: 1;
        -ms-flex-positive: 1;
        flex-grow: 1;
        height: 35px;
        display: inline-block;
        font-size: 15px;
        text-align: center;
        line-height: 36px
    }

    .button-primary[data-v-87ffcada] {
        color: #fff;
        background-color: #ff5a05;
        border-radius: 3px
    }

    .pd[data-v-87ffcada] {
        padding-left: 1.375rem;
        padding-right: 1.375rem
    }

    .article[data-v-87ffcada] {
        max-width: 46.25rem;
        margin: 0 auto
    }

    .article .article-unavailable[data-v-87ffcada] {
        color: #fa8919;
        font-size: 15px;
        font-weight: 600;
        line-height: 24px;
        border-radius: 5px;
        padding: 12px;
        background-color: #f6f7fb;
        margin-top: 20px
    }

    .article .article-unavailable .iconfont[data-v-87ffcada] {
        font-size: 12px
    }

    .article .main[data-v-87ffcada] {
        padding: 1.25rem 0;
        margin-bottom: 52px
    }

    .article-title[data-v-87ffcada] {
        color: #353535;
        font-weight: 400;
        line-height: 1.65rem;
        font-size: 1.34375rem
    }

    .article-info[data-v-87ffcada] {
        color: #888;
        font-size: .9375rem;
        margin-top: 1.0625rem
    }

    .article-content[data-v-87ffcada] {
        margin-top: 1.0625rem
    }

    .article-content.android video[data-v-87ffcada]::-webkit-media-controls-fullscreen-button {
        display: none
    }

    .copyright[data-v-87ffcada] {
        color: #b2b2b2;
        padding-bottom: 20px;
        margin-top: 20px;
        font-size: 13px
    }

    .audio-player[data-v-87ffcada] {
        width: 100%;
        margin: 20px 0
    }

    .to-comment[data-v-87ffcada] {
        overflow: hidden;
        padding-top: 10px;
        margin-bottom: -30px
    }

    .to-comment a.button-primary[data-v-87ffcada] {
        float: right;
        height: 20px;
        font-size: 12px;
        line-height: 20px;
        padding: 4px 8px;
        cursor: pointer
    }

    .article-comments[data-v-87ffcada] {
        margin-top: 2rem
    }

    .article-comments h2[data-v-87ffcada] {
        text-align: center;
        color: #888;
        position: relative;
        z-index: 1;
        margin-bottom: 1rem
    }

    .article-comments h2[data-v-87ffcada]:before {
        border-top: 1px dotted #888;
        content: "";
        position: absolute;
        top: 56%;
        left: 0;
        width: 100%;
        z-index: -1
    }

    .article-comments h2 span[data-v-87ffcada] {
        font-size: 15.25px;
        font-weight: 400;
        padding: 0 1rem;
        background: #fff;
        display: inline-block
    }

    .article-sub-bottom[data-v-87ffcada] {
        z-index: 10;
        cursor: pointer
    }

    .switch-btns[data-v-87ffcada] {
        height: 76px;
        cursor: pointer;
        padding-top: 24px;
        padding-bottom: 24px;
        border-bottom: 10px solid #f6f7fb;
        position: relative
    }

    .switch-btns[data-v-87ffcada]:before {
        content: " ";
        height: 1px;
        background: #e8e8e8;
        position: absolute;
        top: 0;
        left: 0;
        -webkit-box-sizing: border-box;
        box-sizing: border-box;
        left: 1.375rem;
        right: 1.375rem
    }

    .switch-btns .btn[data-v-87ffcada] {
        height: 38px;
        display: -webkit-box;
        display: -ms-flexbox;
        display: flex;
        -webkit-box-align: center;
        -ms-flex-align: center;
        align-items: center
    }

    .switch-btns .btn .tag[data-v-87ffcada] {
        -webkit-box-flex: 0;
        -ms-flex: 0 0 62px;
        flex: 0 0 62px;
        text-align: center;
        color: #888;
        font-size: 14px;
        border-radius: 10px;
        height: 22px;
        line-height: 22px;
        background: #f6f7fb;
        font-weight: 400
    }

    .switch-btns .btn .txt[data-v-87ffcada] {
        margin-left: 10px;
        -webkit-box-flex: 1;
        -ms-flex: 1 1 auto;
        flex: 1 1 auto;
        color: #888;
        font-size: 15px;
        height: 22px;
        line-height: 22px;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        font-weight: 400
    }

    @media (max-width: 769px) {
        .article .breadcrumb[data-v-87ffcada] {
            padding-top: 10px;
            padding-bottom: 10px
        }
    }</style>
    <style type="text/css">.empty {
        height: 51px
    }

    .mobile-tips {
        width: 100%;
        height: 51px;
        background: rgba(0, 0, 0, .8);
        position: fixed;
        top: 0;
        left: 0;
        z-index: 20;
        display: -webkit-box;
        display: -ms-flexbox;
        display: flex;
        -webkit-box-orient: horizontal;
        -webkit-box-direction: normal;
        -ms-flex-direction: row;
        flex-direction: row;
        -webkit-box-align: center;
        -ms-flex-align: center;
        align-items: center;
        -webkit-box-pack: justify;
        -ms-flex-pack: justify;
        justify-content: space-between;
        -webkit-box-sizing: border-box;
        box-sizing: border-box;
        padding: 0 12px;
        -webkit-transition: opacity .35s;
        transition: opacity .35s;
        opacity: 0;
        pointer-events: none
    }

    .mobile-tips.istop {
        opacity: 1;
        pointer-events: auto
    }

    .mobile-tips .mobile-tips-info {
        display: -webkit-box;
        display: -ms-flexbox;
        display: flex;
        -webkit-box-orient: horizontal;
        -webkit-box-direction: normal;
        -ms-flex-direction: row;
        flex-direction: row;
        -webkit-box-align: center;
        -ms-flex-align: center;
        align-items: center;
        -webkit-box-pack: start;
        -ms-flex-pack: start;
        justify-content: flex-start
    }

    .mobile-tips .mobile-tips-info i {
        width: 36px;
        height: 36px;
        background-image: url(data:image/png;base64,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);
        background-position: 0 0;
        background-repeat: no-repeat;
        background-size: contain;
        border-radius: 7px
    }

    .mobile-tips .mobile-tips-info h2 {
        font-size: 15px;
        color: #fff;
        font-weight: 400;
        margin-left: 6px
    }

    .mobile-tips .mobile-tips-info h2 span {
        font-size: 11px
    }

    .mobile-tips a {
        width: 72px;
        height: 31px;
        text-align: center;
        border: 1px solid #fa8919;
        border-radius: 3px;
        font-size: 13px;
        color: #fa8919;
        line-height: 31px
    }</style>
    <style type="text/css">.share-poster-wrapper {
        position: fixed;
        background-color: #fff;
        left: 0;
        bottom: 0;
        z-index: 100;
        display: -webkit-box;
        display: -ms-flexbox;
        display: flex;
        overflow: hidden;
        width: 100%;
        -webkit-box-orient: vertical;
        -webkit-box-direction: normal;
        -ms-flex-direction: column;
        flex-direction: column;
        -moz-user-select: -moz-none;
        -webkit-user-select: none;
        -ms-user-select: none;
        user-select: none
    }

    .share-poster-wrapper .poster-bottom, .share-poster-wrapper .poster-middle, .share-poster-wrapper .poster-top {
        -ms-flex-negative: 0;
        flex-shrink: 0
    }

    .share-poster-wrapper .poster-middle {
        padding: 16px 32px;
        -webkit-box-sizing: border-box;
        box-sizing: border-box
    }

    .share-poster-wrapper .poster-middle .poster-userinfo {
        display: -webkit-box;
        display: -ms-flexbox;
        display: flex;
        -webkit-box-align: center;
        -ms-flex-align: center;
        align-items: center;
        padding-bottom: 18px
    }

    .share-poster-wrapper .poster-middle .poster-userinfo .poster-avatar {
        min-width: 45px;
        min-height: 45px;
        width: 7vw;
        height: 7vw;
        border-radius: 50%;
        -ms-flex-negative: 0;
        flex-shrink: 0
    }

    .share-poster-wrapper .poster-middle .nickname {
        font-size: 5vw;
        font-weight: 400;
        margin-left: 18px
    }

    .share-poster-wrapper .poster-middle .time {
        font-size: 3.2vw
    }

    .share-poster-wrapper .poster-middle .poster-middle-content {
        font-size: 4vw;
        font-weight: 400;
        white-space: normal;
        word-wrap: break-word;
        word-break: break-word;
        letter-spacing: 1px
    }

    .share-poster-wrapper .poster-middle .poster-middle-content p {
        margin-bottom: 22px
    }

    .share-poster-wrapper .poster-middle .quote-content {
        font-size: 3.7vw;
        padding: 32px 0
    }

    .share-poster-wrapper .poster-middle .quote-content p {
        margin-bottom: 22px
    }

    .share-poster-wrapper .poster-middle .quote-info {
        border-left: 1px solid #000;
        padding-left: 10px;
        margin-top: 38px
    }

    .share-poster-wrapper .poster-middle .quote-info p {
        font-size: 3.2vw;
        line-height: 1.5
    }

    .share-poster-wrapper.theme0 .poster-top {
        width: 100%;
        height: 25px;
        margin-top: 27px;
        background: url("https://static001.geekbang.org/static/time/page/img/sharePoster/theme1/top.png") no-repeat 15px 1px
    }

    .share-poster-wrapper.theme0 .poster-middle {
        width: 100%;
        padding-left: 56px;
        padding-right: 56px;
        background-image: url("https://static001.geekbang.org/static/time/page/img/sharePoster/theme1/middle.png");
        background-repeat: repeat-y;
        background-position: 15px 0
    }

    .share-poster-wrapper.theme0 .poster-middle .time {
        margin-bottom: 45px
    }

    .share-poster-wrapper.theme0 .poster-middle .quote-content {
        border-top: 1px solid #e3e1dc;
        margin-top: 30px
    }

    .share-poster-wrapper.theme0 .poster-bottom {
        width: 100%;
        height: 25px;
        margin-bottom: 27px;
        background: url("https://static001.geekbang.org/static/time/page/img/sharePoster/theme1/bottom.png") no-repeat 15px -10px
    }

    .share-poster-wrapper.theme1 .poster-top {
        width: 100%;
        height: 25px;
        margin-top: 27px;
        background: url("https://static001.geekbang.org/static/time/page/img/sharePoster/theme0/top.png") no-repeat 38px 1px
    }

    .share-poster-wrapper.theme1 .poster-middle {
        width: 100%;
        padding: 0 42px 10px;
        background: url("https://static001.geekbang.org/static/time/page/img/sharePoster/theme0/middle.png") repeat-y 38px 0
    }

    .share-poster-wrapper.theme1 .poster-middle .poster-userinfo {
        border-bottom: 1px solid #b5a899
    }

    .share-poster-wrapper.theme1 .poster-middle .poster-userinfo .poster-avatar {
        margin-left: 38px
    }

    .share-poster-wrapper.theme1 .poster-middle .poster-middle-wrapper {
        display: -webkit-box;
        display: -ms-flexbox;
        display: flex;
        -webkit-box-orient: horizontal;
        -webkit-box-direction: normal;
        -ms-flex-direction: row;
        flex-direction: row;
        min-height: 260px;
        border-bottom: 1px solid #b5a899
    }

    .share-poster-wrapper.theme1 .poster-middle .time {
        max-width: 65px;
        display: -webkit-box;
        display: -ms-flexbox;
        display: flex;
        -webkit-box-orient: vertical;
        -webkit-box-direction: normal;
        -ms-flex-direction: column;
        flex-direction: column;
        -webkit-box-pack: center;
        -ms-flex-pack: center;
        justify-content: center;
        -webkit-box-align: center;
        -ms-flex-align: center;
        align-items: center;
        text-align: center;
        vertical-align: middle;
        border-right: 1px solid #b5a899
    }

    .share-poster-wrapper.theme1 .poster-middle .time span {
        white-space: nowrap;
        -webkit-transform: rotate(90deg);
        transform: rotate(90deg)
    }

    .share-poster-wrapper.theme1 .poster-middle .poster-middle-content {
        padding: 30px
    }

    .share-poster-wrapper.theme1 .poster-middle .quote-content {
        font-size: 3.7vw;
        margin-left: 36px;
        margin-right: 36px
    }

    .share-poster-wrapper.theme1 .poster-middle .quote-info {
        margin-left: 36px;
        margin-right: 36px
    }

    .share-poster-wrapper.theme1 .poster-middle .footer {
        display: -webkit-box;
        display: -ms-flexbox;
        display: flex;
        -webkit-box-orient: horizontal;
        -webkit-box-direction: normal;
        -ms-flex-direction: row;
        flex-direction: row;
        margin-right: 30px
    }

    .share-poster-wrapper.theme1 .poster-bottom {
        width: 100%;
        height: 25px;
        margin-bottom: 27px;
        background: url("https://static001.geekbang.org/static/time/page/img/sharePoster/theme0/bottom.png") no-repeat 38px -10px
    }

    .share-poster-wrapper .share-poster {
        background: #fefdf8;
        -webkit-box-sizing: border-box;
        box-sizing: border-box;
        color: #9b8d73;
        -webkit-box-flex: 1;
        -ms-flex-positive: 1;
        flex-grow: 1;
        overflow: auto;
        display: -webkit-box;
        display: -ms-flexbox;
        display: flex;
        -webkit-box-orient: vertical;
        -webkit-box-direction: normal;
        -ms-flex-direction: column;
        flex-direction: column;
        -webkit-overflow-scrolling: touch;
        -webkit-box-align: center;
        -ms-flex-align: center;
        align-items: center
    }

    .share-poster-wrapper .share-poster.color0 {
        background-color: #fefdf8
    }

    .share-poster-wrapper .share-poster.color1 {
        background-color: #4d4d4d
    }

    .share-poster-wrapper .share-poster .footer {
        margin-top: 2rem;
        position: relative;
        display: -webkit-box;
        display: -ms-flexbox;
        display: flex;
        -webkit-box-orient: horizontal;
        -webkit-box-direction: normal;
        -ms-flex-direction: row;
        flex-direction: row;
        -webkit-box-pack: end;
        -ms-flex-pack: end;
        justify-content: flex-end;
        -webkit-box-align: end;
        -ms-flex-align: end;
        align-items: flex-end
    }

    .share-poster-wrapper .share-poster .footer p {
        margin: 0;
        line-height: 1.4;
        margin-left: 20px;
        text-align: right;
        padding-right: 20px
    }

    .share-poster-wrapper .controls {
        background: #fff;
        border-top: 1px solid #f5f5f5;
        width: 100%;
        padding-top: 5px;
        -webkit-box-shadow: 0 -4px 10px 0 rgba(0, 0, 0, .1);
        box-shadow: 0 -4px 10px 0 rgba(0, 0, 0, .1);
        z-index: 1;
        -ms-flex-negative: 0;
        flex-shrink: 0
    }

    .share-poster-wrapper .controls > div {
        display: -webkit-box;
        display: -ms-flexbox;
        display: flex;
        -webkit-box-orient: horizontal;
        -webkit-box-direction: normal;
        -ms-flex-direction: row;
        flex-direction: row;
        -webkit-box-pack: center;
        -ms-flex-pack: center;
        justify-content: center;
        -webkit-box-align: center;
        -ms-flex-align: center;
        align-items: center;
        padding: 10px 0
    }

    .share-poster-wrapper .controls > div span {
        font-size: .85rem
    }

    .share-poster-wrapper .controls > div button {
        width: 100px;
        height: 24px;
        background: #eee;
        margin: 0 10px;
        border-radius: 5px;
        border: 2px solid #b2b2b2;
        outline: none
    }

    .share-poster-wrapper .controls > div button.on {
        border: 2px solid #ff5a05
    }

    .share-poster-wrapper .controls .controls-themes button {
        color: #b2b2b2;
        font-size: 12px;
        background: #fff;
        text-align: center
    }

    .share-poster-wrapper .controls .controls-themes button.on {
        color: #ff5a05
    }

    .share-poster-wrapper .buttons {
        background: #fff;
        border-top: 1px solid #f5f5f5;
        display: -webkit-box;
        display: -ms-flexbox;
        display: flex;
        -webkit-box-orient: horizontal;
        -webkit-box-direction: normal;
        -ms-flex-direction: row;
        flex-direction: row;
        -ms-flex-negative: 0;
        flex-shrink: 0
    }

    .share-poster-wrapper .buttons a {
        -webkit-box-flex: 1;
        -ms-flex-positive: 1;
        flex-grow: 1;
        text-align: center;
        color: #000;
        font-weight: 400;
        height: 3rem;
        line-height: 3rem
    }

    .share-poster-wrapper .buttons a .icon-share-money {
        width: 1rem;
        height: 1rem;
        margin: 3px 0 0 5px
    }

    .share-poster-wrapper .buttons a:last-child {
        border-left: 1px solid #f5f5f5
    }

    .share-poster-wrapper img {
        max-width: 100%
    }

    .share-poster-wrapper.android .poster-middle .nickname {
        font-size: 10vw
    }

    .share-poster-wrapper.android .poster-middle .time {
        font-size: 6.4vw
    }

    .share-poster-wrapper.android .poster-middle .poster-middle-content {
        font-size: 8vw
    }

    .share-poster-wrapper.android .poster-middle .quote-content {
        font-size: 7.4vw
    }

    .share-poster-wrapper.android .poster-middle .quote-info p {
        font-size: 6.4vw
    }</style>
    <style type="text/css">.mini-audio-player {
        width: 100%;
        height: 5.25rem;
        border: 1px solid #d9d9d9;
        background: #fafafa;
        -webkit-box-sizing: border-box;
        box-sizing: border-box;
        padding: 1rem;
        display: -webkit-box;
        display: -ms-flexbox;
        display: flex;
        -webkit-box-orient: horizontal;
        -webkit-box-direction: normal;
        -ms-flex-direction: row;
        flex-direction: row;
        -webkit-box-align: center;
        -ms-flex-align: center;
        align-items: center;
        -webkit-box-pack: justify;
        -ms-flex-pack: justify;
        justify-content: space-between;
        margin: 1rem 0
    }

    .mini-audio-player > a {
        border: none;
        -ms-flex-negative: 0;
        flex-shrink: 0
    }

    .mini-audio-player .btn-play {
        background-image: url(data:image/png;base64,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)
    }

    .mini-audio-player .btn-pause, .mini-audio-player .btn-play {
        width: 2.6875rem;
        height: 2.6875rem;
        background-repeat: no-repeat;
        background-position: 0 0;
        background-size: contain;
        text-decoration: none
    }

    .mini-audio-player .btn-pause {
        background-image: url(data:image/png;base64,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)
    }

    .mini-audio-player .audio-info {
        display: -webkit-box;
        display: -ms-flexbox;
        display: flex;
        -webkit-box-flex: 1;
        -ms-flex-positive: 1;
        flex-grow: 1;
        -webkit-box-orient: vertical;
        -webkit-box-direction: normal;
        -ms-flex-direction: column;
        flex-direction: column;
        margin-left: .6875rem;
        min-width: 0
    }

    .mini-audio-player .audio-info h3 {
        color: #353535;
        font-size: 15.25px;
        margin: 0;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis
    }

    .mini-audio-player .audio-info p {
        margin: 0;
        margin-top: .125rem;
        font-size: 11px;
        line-height: 1rem
    }

    .mini-audio-player .audio-info p span {
        color: #888
    }

    .mini-audio-player .btn-download {
        width: 1.25rem;
        height: 1.25rem;
        position: relative;
        background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAA+CAYAAACbQR1vAAABS2lUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4KPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxMzggNzkuMTU5ODI0LCAyMDE2LzA5LzE0LTAxOjA5OjAxICAgICAgICAiPgogPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIi8+CiA8L3JkZjpSREY+CjwveDp4bXBtZXRhPgo8P3hwYWNrZXQgZW5kPSJyIj8+IEmuOgAAA4hJREFUaIHtm8lOFFEUhr9qCWGHGxcaY1joK2h0YRzAtYmsWbAGGidEXOACbAYRxfgAPoEPoInGxJgg86gsJTHMw86EhS7O7TDk3uqq6qo6HahvQ7pOce7//1U0feve9vr6+lAiD3QC/4AC8FZDRJXGoMB14PWB1yPANPA1bSG5tAc0XLEcu5y6CvQCOGU5pnI3agVQMWQBaAvQJgtAW4A2WQDaArTJAtAWoE0WgLYAbbIAtAVokwWgLUCbLABtAdpkAfjU6oC7wKV0pCTCRcRDnesEVwDNwC/gg/nZHbeyFOgGltj30Gw7yRZALfAOqDavPeA50BO7xOToQTR75nU14qn26Im2AM4DNZbjz4DeePQlSi+i9Sg1iLdD2AJYApYdzbuo7BBeIBptLCPeDmELYA9oBHYdjbqQpaxKowA8ddR2gXuIt0O43gRHgTu4Q+ikskIoIJps7AINwA9b0e/fYJAQ1FZWD9CP2/wOUI/DPJT+IDRqGrhCeGIEaNEPdDhqO8iVH/NrEOST4BgSwo6j3gEMBOgTNwP4m6+nhHkI/lG4VAiPgcGAveJg0IxpYxvROh6kUZi5wLhpvO2oPyKdEF6asWyEMg/hJ0PjyN+VXwhDIXuGYQh46KhtIeYnwjSMMhss3glbjvoDkglhyPS2Eck8RJ8OTyB3gl8IryL2tjGM2/wmYn4ySuNyngdMmIE3HfX7iHDPUQ+CZ3q0O+qbyIWIZB7KfyAyaQS4QmhH7oQoIZQyv0EZV75IHE+EJvG/E9oJfyd4yC6yvKO+gQQ/FaKnlbgeiU0hIWw46nnEUJAQiubbHPV1M1bZ5iHeZ4KlQmgD3uAfgofsGfQz34DsKYyFuLemTSMhfATOWOqtiMk/llrRfIuj9zpwG5gtX+Y+SezNK4bwCXsILdgDaAXOOnomYh6Seyw+gwhed9TPWY75mb9FAuYh2XWBWUS4K4QgrAE3gblYFFlIemFkDjEQJYQ1JMD5WBUdIY2VoXkkhLUQv7NqfidR85De0liYEFaRK7+QqCJDmmuDC0gIqz7nrJhzUjEP6S+O+oWwglz5xTQFaawOLwI3gO8Hjo2ZY6maB72vzPwErgEXkO8MuVaiEkcrgCK/lcfPNkhkAWgL0KYKmZiMIG9Ktn0Bx5G/wDcgXwW8R6avJ41G4HQOufInlas5ZO5+UpnJAU3AFyy7J44xe8BnoOk/JruwYo92bigAAAAASUVORK5CYII=);
        background-repeat: no-repeat;
        background-position: 0 0;
        background-size: contain;
        text-decoration: none;
        padding-right: .25rem
    }

    .mini-audio-player .btn-download .icon-download-done {
        width: .45rem;
        height: .45rem;
        position: absolute;
        bottom: 0;
        right: 0;
        display: inline-block;
        background-image: url(data:image/png;base64,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);
        background-repeat: no-repeat;
        background-position: 0 0;
        background-size: contain
    }</style>
    <style type="text/css">.MathJax_Display {
        overflow: auto
    }

    .poster {
        position: fixed;
        left: -10000px;
        top: -10000px;
        overflow: hidden;
        padding: 1rem;
        background: #ececec
    }

    .richcontent-pre-copy {
        font-size: 13px;
        color: #888;
        position: absolute;
        right: 1em;
        top: .2em;
        cursor: pointer;
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none
    }

    .richcontent-pre-copy .iconfont {
        font-size: 12px;
        margin-right: .2em
    }</style>
    <style type="text/css">.breadcrumb {
        padding: 30px 0;
        display: -webkit-box;
        display: -ms-flexbox;
        display: flex;
        -webkit-box-orient: horizontal;
        -webkit-box-direction: normal;
        -ms-flex-direction: row;
        flex-direction: row;
        -webkit-box-align: center;
        -ms-flex-align: center;
        align-items: center;
        -ms-flex-wrap: wrap;
        flex-wrap: wrap;
        background: #fff
    }

    .breadcrumb a.title {
        color: #e57c39;
        font-size: 15px;
        font-weight: 400
    }

    .breadcrumb span.title {
        color: #888;
        font-size: 15px;
        font-weight: 400
    }

    .breadcrumb .split {
        color: #ccc;
        font-size: 10px;
        margin-right: 5px
    }</style>
    <style type="text/css">.comment-item {
        list-style-position: inside;
        width: 100%;
        display: -webkit-box;
        display: -ms-flexbox;
        display: flex;
        -webkit-box-orient: horizontal;
        -webkit-box-direction: normal;
        -ms-flex-direction: row;
        flex-direction: row;
        margin-bottom: 1rem
    }

    .comment-item a {
        border-bottom: none
    }

    .comment-item .avatar {
        width: 2.625rem;
        height: 2.625rem;
        -ms-flex-negative: 0;
        flex-shrink: 0;
        border-radius: 50%
    }

    .comment-item .info {
        margin-left: .5rem;
        -webkit-box-flex: 1;
        -ms-flex-positive: 1;
        flex-grow: 1
    }

    .comment-item .info .hd {
        width: 100%;
        display: -webkit-box;
        display: -ms-flexbox;
        display: flex;
        -webkit-box-orient: horizontal;
        -webkit-box-direction: normal;
        -ms-flex-direction: row;
        flex-direction: row;
        -webkit-box-pack: justify;
        -ms-flex-pack: justify;
        justify-content: space-between;
        -webkit-box-align: center;
        -ms-flex-align: center;
        align-items: center
    }

    .comment-item .info .hd .username {
        color: #888;
        font-size: 15.25px;
        font-weight: 400;
        line-height: 1.2
    }

    .comment-item .info .hd .control {
        display: -webkit-box;
        display: -ms-flexbox;
        display: flex;
        -webkit-box-orient: horizontal;
        -webkit-box-direction: normal;
        -ms-flex-direction: row;
        flex-direction: row;
        -webkit-box-align: center;
        -ms-flex-align: center;
        align-items: center
    }

    .comment-item .info .hd .control .btn-share {
        color: #888;
        font-size: .75rem;
        margin-right: 1rem
    }

    .comment-item .info .hd .control .btn-praise {
        display: -webkit-box;
        display: -ms-flexbox;
        display: flex;
        -webkit-box-orient: horizontal;
        -webkit-box-direction: normal;
        -ms-flex-direction: row;
        flex-direction: row;
        -webkit-box-align: center;
        -ms-flex-align: center;
        align-items: center;
        font-size: 15.25px;
        text-decoration: none
    }

    .comment-item .info .hd .control .btn-praise i {
        color: #888;
        display: inline-block;
        font-size: .75rem;
        margin-right: .3rem;
        margin-top: -.01rem
    }

    .comment-item .info .hd .control .btn-praise i.on, .comment-item .info .hd .control .btn-praise span {
        color: #fa8919
    }

    .comment-item .info .bd {
        color: #353535;
        font-size: 15.25px;
        font-weight: 400;
        white-space: normal;
        word-break: break-all;
        line-height: 1.6
    }

    .comment-item .info .time {
        color: #888;
        font-size: 9px;
        line-height: 1
    }

    .comment-item .info .reply .reply-hd {
        font-size: 15.25px
    }

    .comment-item .info .reply .reply-hd span {
        margin-left: -12px;
        color: #888;
        font-weight: 400
    }

    .comment-item .info .reply .reply-hd i {
        color: #fa8919;
        font-size: 15.25px
    }

    .comment-item .info .reply .reply-content {
        color: #353535;
        font-size: 15.25px;
        font-weight: 400;
        white-space: normal;
        word-break: break-all
    }

    .comment-item .info .reply .reply-time {
        color: #888;
        font-size: 9px
    }

    .comment-template {
        display: none;
    }
    </style>
</head>
<body>

<div id="app">
    <div data-v-87ffcada="" class="article"><!---->
        <div data-v-87ffcada="" class="main main-app">
            <h1 data-v-87ffcada="" class="article-title pd">
                16 | Semaphore：如何快速实现一个限流器？
            </h1>
            <div data-v-87ffcada="" class="article-info pd"><span data-v-87ffcada="">2019-04-04</span> <span data-v-87ffcada="">王宝令</span></div>
            <div data-v-87ffcada="" class="article-content typo common-content pd">
                <img data-v-87ffcada="" src="https://static001.geekbang.org/resource/image/c7/0a/c7e8447ca5fdca13b6722802ac72e00a.jpg">
                <!---->
                <div data-v-87ffcada="" class="mini-audio-player">
                    <div class="audio-info">
                        <p><span>朗读人：王宝令&nbsp;&nbsp;&nbsp;</span>
                        </p></div> <!---->
                    <audio title="" src="https://static001.geekbang.org/resource/audio/55/65/559dfe29a26ff9351fcd69e127609265.mp3" controls="controls"></audio>
                </div>
                <div data-v-87ffcada="" id="article-content" class="">
                    <div class="text"><p>Semaphore，现在普遍翻译为“信号量”，以前也曾被翻译成“信号灯”，因为类似现实生活里的红绿灯，车辆能不能通行，要看是不是绿灯。同样，在编程世界里，线程能不能执行，也要看信号量是不是允许。</p><p>信号量是由大名鼎鼎的计算机科学家迪杰斯特拉（Dijkstra）于1965年提出，在这之后的15年，信号量一直都是并发编程领域的终结者，直到1980年管程被提出来，我们才有了第二选择。目前几乎所有支持并发编程的语言都支持信号量机制，所以学好信号量还是很有必要的。</p><p>下面我们首先介绍信号量模型，之后介绍如何使用信号量，最后我们再用信号量来实现一个限流器。</p><h2>信号量模型</h2><p>信号量模型还是很简单的，可以简单概括为：<strong>一个计数器，一个等待队列，三个方法</strong>。在信号量模型里，计数器和等待队列对外是透明的，所以只能通过信号量模型提供的三个方法来访问它们，这三个方法分别是：init()、down()和up()。你可以结合下图来形象化地理解。</p><p><img src="https://static001.geekbang.org/resource/image/6d/5c/6dfeeb9180ff3e038478f2a7dccc9b5c.png" alt=""></p><center><span class="reference">信号量模型图</span></center><p>这三个方法详细的语义具体如下所示。</p><ul>
<li>init()：设置计数器的初始值。</li>
<li>down()：计数器的值减1；如果此时计数器的值小于0，则当前线程将被阻塞，否则当前线程可以继续执行。</li>
<li>up()：计数器的值加1；如果此时计数器的值小于或者等于0，则唤醒等待队列中的一个线程，并将其从等待队列中移除。</li>
</ul><!-- [[[read_end]]] --><p>这里提到的init()、down()和up()三个方法都是原子性的，并且这个原子性是由信号量模型的实现方保证的。在Java SDK里面，信号量模型是由java.util.concurrent.Semaphore实现的，Semaphore这个类能够保证这三个方法都是原子操作。</p><p>如果你觉得上面的描述有点绕的话，可以参考下面这个代码化的信号量模型。</p><pre><code>class Semaphore{
  // 计数器
  int count;
  // 等待队列
  Queue queue;
  // 初始化操作
  Semaphore(int c){
    this.count=c;
  }
  // 
  void down(){
    this.count--;
    if(this.count&lt;0){
      //将当前线程插入等待队列
      //阻塞当前线程
    }
  }
  void up(){
    this.count++;
    if(this.count&lt;=0) {
      //移除等待队列中的某个线程T
      //唤醒线程T
    }
  }
}
</code></pre><p>这里再插一句，信号量模型里面，down()、up()这两个操作历史上最早称为P操作和V操作，所以信号量模型也被称为PV原语。另外，还有些人喜欢用semWait()和semSignal()来称呼它们，虽然叫法不同，但是语义都是相同的。在Java SDK并发包里，down()和up()对应的则是acquire()和release()。</p><h2>如何使用信号量</h2><p>通过上文，你应该会发现信号量的模型还是很简单的，那具体该如何使用呢？其实你想想红绿灯就可以了。十字路口的红绿灯可以控制交通，得益于它的一个关键规则：车辆在通过路口前必须先检查是否是绿灯，只有绿灯才能通行。这个规则和我们前面提到的锁规则是不是很类似？</p><p>其实，信号量的使用也是类似的。这里我们还是用累加器的例子来说明信号量的使用吧。在累加器的例子里面，count+=1操作是个临界区，只允许一个线程执行，也就是说要保证互斥。那这种情况用信号量怎么控制呢？</p><p>其实很简单，就像我们用互斥锁一样，只需要在进入临界区之前执行一下down()操作，退出临界区之前执行一下up()操作就可以了。下面是Java代码的示例，acquire()就是信号量里的down()操作，release()就是信号量里的up()操作。</p><pre><code>static int count;
//初始化信号量
static final Semaphore s 
    = new Semaphore(1);
//用信号量保证互斥    
static void addOne() {
  s.acquire();
  try {
    count+=1;
  } finally {
    s.release();
  }
}
</code></pre><p>下面我们再来分析一下，信号量是如何保证互斥的。假设两个线程T1和T2同时访问addOne()方法，当它们同时调用acquire()的时候，由于acquire()是一个原子操作，所以只能有一个线程（假设T1）把信号量里的计数器减为0，另外一个线程（T2）则是将计数器减为-1。对于线程T1，信号量里面的计数器的值是0，大于等于0，所以线程T1会继续执行；对于线程T2，信号量里面的计数器的值是-1，小于0，按照信号量模型里对down()操作的描述，线程T2将被阻塞。所以此时只有线程T1会进入临界区执行<code>count+=1；</code>。</p><p>当线程T1执行release()操作，也就是up()操作的时候，信号量里计数器的值是-1，加1之后的值是0，小于等于0，按照信号量模型里对up()操作的描述，此时等待队列中的T2将会被唤醒。于是T2在T1执行完临界区代码之后才获得了进入临界区执行的机会，从而保证了互斥性。</p><h2>快速实现一个限流器</h2><p>上面的例子，我们用信号量实现了一个最简单的互斥锁功能。估计你会觉得奇怪，既然有Java SDK里面提供了Lock，为啥还要提供一个Semaphore ？其实实现一个互斥锁，仅仅是 Semaphore的部分功能，Semaphore还有一个功能是Lock不容易实现的，那就是：<strong>Semaphore可以允许多个线程访问一个临界区</strong>。</p><p>现实中还有这种需求？有的。比较常见的需求就是我们工作中遇到的各种池化资源，例如连接池、对象池、线程池等等。其中，你可能最熟悉数据库连接池，在同一时刻，一定是允许多个线程同时使用连接池的，当然，每个连接在被释放前，是不允许其他线程使用的。</p><p>其实前不久，我在工作中也遇到了一个对象池的需求。所谓对象池呢，指的是一次性创建出N个对象，之后所有的线程重复利用这N个对象，当然对象在被释放前，也是不允许其他线程使用的。对象池，可以用List保存实例对象，这个很简单。但关键是限流器的设计，这里的限流，指的是不允许多于N个线程同时进入临界区。那如何快速实现一个这样的限流器呢？这种场景，我立刻就想到了信号量的解决方案。</p><p>信号量的计数器，在上面的例子中，我们设置成了1，这个1表示只允许一个线程进入临界区，但如果我们把计数器的值设置成对象池里对象的个数N，就能完美解决对象池的限流问题了。下面就是对象池的示例代码。</p><pre><code>class ObjPool&lt;T, R&gt; {
  final List&lt;T&gt; pool;
  // 用信号量实现限流器
  final Semaphore sem;
  // 构造函数
  ObjPool(int size, T t){
    pool = new Vector&lt;T&gt;(){};
    for(int i=0; i&lt;size; i++){
      pool.add(t);
    }
    sem = new Semaphore(size);
  }
  // 利用对象池的对象，调用func
  R exec(Function&lt;T,R&gt; func) {
    T t = null;
    sem.acquire();
    try {
      t = pool.remove(0);
      return func.apply(t);
    } finally {
      pool.add(t);
      sem.release();
    }
  }
}
// 创建对象池
ObjPool&lt;Long, String&gt; pool = 
  new ObjPool&lt;Long, String&gt;(10, 2);
// 通过对象池获取t，之后执行  
pool.exec(t -&gt; {
    System.out.println(t);
    return t.toString();
});
</code></pre><p>我们用一个List<t>来保存对象实例，用Semaphore实现限流器。关键的代码是ObjPool里面的exec()方法，这个方法里面实现了限流的功能。在这个方法里面，我们首先调用acquire()方法（与之匹配的是在finally里面调用release()方法），假设对象池的大小是10，信号量的计数器初始化为10，那么前10个线程调用acquire()方法，都能继续执行，相当于通过了信号灯，而其他线程则会阻塞在acquire()方法上。对于通过信号灯的线程，我们为每个线程分配了一个对象 t（这个分配工作是通过pool.remove(0)实现的），分配完之后会执行一个回调函数func，而函数的参数正是前面分配的对象 t ；执行完回调函数之后，它们就会释放对象（这个释放工作是通过pool.add(t)实现的），同时调用release()方法来更新信号量的计数器。如果此时信号量里计数器的值小于等于0，那么说明有线程在等待，此时会自动唤醒等待的线程。</t></p><p>简言之，使用信号量，我们可以轻松地实现一个限流器，使用起来还是非常简单的。</p><h2>总结</h2><p>信号量在Java语言里面名气并不算大，但是在其他语言里却是很有知名度的。Java在并发编程领域走的很快，重点支持的还是管程模型。 管程模型理论上解决了信号量模型的一些不足，主要体现在易用性和工程化方面，例如用信号量解决我们曾经提到过的阻塞队列问题，就比管程模型麻烦很多，你如果感兴趣，可以课下了解和尝试一下。</p><h2>课后思考</h2><p>在上面对象池的例子中，对象保存在了Vector中，Vector是Java提供的线程安全的容器，如果我们把Vector换成ArrayList，是否可以呢？</p><p>欢迎在留言区与我分享你的想法，也欢迎你在留言区记录你的思考过程。感谢阅读，如果你觉得这篇文章对你有帮助的话，也欢迎把它分享给更多的朋友。</p><p><img src="https://static001.geekbang.org/resource/image/cf/aa/cf393cd748a4f0e6451807c4b61843aa.jpg" alt=""></p></div>
                </div> <!---->
                <div data-v-87ffcada="" class="copyright">
                    ©版权归极客邦科技所有，未经许可不得转载
                </div>
            </div>
            <div data-v-87ffcada="" class="article-comments pd"><h2 data-v-87ffcada=""><span data-v-87ffcada="">精选留言</span></h2>
                <ul data-v-87ffcada="">

                    <li data-v-87ffcada="" class="comment-item comment-template">
                        <img src="${user_header}" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">${user_name}</span>
                                <div class="control"><!----> <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span class="like-count">${like_count}</span></a></div>
                            </div>
                            <div class="bd comment-content">${comment_content}
                            </div>
                            <span class="time">${comment_ctime}</span>
                            <div class="reply">
                                <div class="reply-hd"><i class="iconfont"></i> <span class="reply-username">${user_name}</span></div>
                                <p class="reply-content">${content}</p>
                                <p class="reply-time">${ctime}</p></div>
                        </div>
                    </li>
                <li data-v-87ffcada="" class="comment-item">
                        <img src="https://static001.geekbang.org/account/avatar/00/13/03/f7/3a493bec.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">老杨同志</span>
                                <div class="control"><!----> <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span class="like-count">32</span></a></div>
                            </div>
                            <div class="bd comment-content">需要用线程安全的vector，因为信号量支持多个线程进入临界区，执行list的add和remove方法时可能是多线程并发执行</div>
                            <span class="time">2019-04-04</span>
                            <div class="reply">
                                <div class="reply-hd"><i class="iconfont"></i> <span class="reply-username">作者回复</span></div>
                                <p class="reply-content">👍</p>
                                <p class="reply-time">2019-04-04</p></div>
                        </div>
                    </li><li data-v-87ffcada="" class="comment-item">
                        <img src="https://static001.geekbang.org/account/avatar/00/0f/50/da/ed4803cb.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">CCC</span>
                                <div class="control"><!----> <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span class="like-count">26</span></a></div>
                            </div>
                            <div class="bd comment-content">我理解的和管程相比，信号量可以实现的独特功能就是同时允许多个线程进入临界区，但是信号量不能做的就是同时唤醒多个线程去争抢锁，只能唤醒一个阻塞中的线程，而且信号量模型是没有Condition的概念的，即阻塞线程被醒了直接就运行了而不会去检查此时临界条件是否已经不满足了，基于此考虑信号量模型才会设计出只能让一个线程被唤醒，否则就会出现因为缺少Condition检查而带来的线程安全问题。正因为缺失了Condition，所以用信号量来实现阻塞队列就很麻烦，因为要自己实现类似Condition的逻辑。</div>
                            <span class="time">2019-04-04</span>
                            <div class="reply">
                                <div class="reply-hd"><i class="iconfont"></i> <span class="reply-username">作者回复</span></div>
                                <p class="reply-content">👍👍👍<br></p>
                                <p class="reply-time">2019-04-04</p></div>
                        </div>
                    </li><li data-v-87ffcada="" class="comment-item">
                        <img src="https://static001.geekbang.org/account/avatar/00/10/4f/f9/1f0a9665.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">任大鹏</span>
                                <div class="control"><!----> <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span class="like-count">8</span></a></div>
                            </div>
                            <div class="bd comment-content">有同学认为up()中的判断条件应该&gt;=0，我觉得有可能理解为生产者-消费者模式中的生产者了。可以这么想，&gt;0就意味着没有阻塞的线程了，所以只有&lt;=0的情况才需要唤醒一个等待的线程。其实down()和up()是成对出现的，并且是先调用down()获得锁，处理完成再调用up()释放锁，如果信号量初始值为1，应该是不会出现&gt;0的情况的，除非故意调先用up()，这也失去了信号量本身的意义了。不知道我理解的对不对。</div>
                            <span class="time">2019-04-04</span>
                            <div class="reply">
                                <div class="reply-hd"><i class="iconfont"></i> <span class="reply-username">作者回复</span></div>
                                <p class="reply-content">对👍👍👍<br></p>
                                <p class="reply-time">2019-04-05</p></div>
                        </div>
                    </li><li data-v-87ffcada="" class="comment-item">
                        <img src="https://static001.geekbang.org/account/avatar/00/11/ac/ef/8336bd81.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">crazypokerk</span>
                                <div class="control"><!----> <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span class="like-count">8</span></a></div>
                            </div>
                            <div class="bd comment-content">文中，up()：计数器的值加 1；如果此时计数器的值小于或者等于0，这句话应该是大于等于0吧<br></div>
                            <span class="time">2019-04-04</span>
                            
                        </div>
                    </li><li data-v-87ffcada="" class="comment-item">
                        <img src="https://static001.geekbang.org/account/avatar/00/13/01/6e/a217a0f6.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">master</span>
                                <div class="control"><!----> <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span class="like-count">3</span></a></div>
                            </div>
                            <div class="bd comment-content">老师，void  up()方法中的this.count判断条件是否应该为&gt;=0</div>
                            <span class="time">2019-04-04</span>
                            
                        </div>
                    </li><li data-v-87ffcada="" class="comment-item">
                        <img src="https://static001.geekbang.org/account/avatar/00/0f/fe/b5/df0f658f.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">ken</span>
                                <div class="control"><!----> <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span class="like-count">2</span></a></div>
                            </div>
                            <div class="bd comment-content"><br>public class Food {<br><br>    public String name;<br><br>    private long warmTime;<br><br>    public Food(String name, long warmTime) {<br>        this.name = name;<br>        this.warmTime = warmTime;<br>    }<br><br>    public String getName() {<br>        return name;<br>    }<br><br>    public long getWarmTime() {<br>        return warmTime;<br>    }<br>}<br><br><br><br>public class MicrowaveOven {<br><br>    public String name;<br><br>    public MicrowaveOven(String name) {<br>        this.name = name;<br>    }<br><br>    public Food warm(Food food) {<br>        long second = food.getWarmTime() * 1000;<br>        try {<br>            Thread.sleep(second);<br>        } catch (InterruptedException e) {<br>            e.printStackTrace();<br>        }<br><br>        System.out.println(String.format("%s warm %s %d seconds food.", name,food.getName() ,food.getWarmTime()));<br>        return food;<br>    }<br><br>    public String getName() {<br>        return name;<br>    }<br>}<br>public class MicrowaveOvenPool {<br><br>    private List&lt;MicrowaveOven&gt; microwaveOvens;<br><br>    private Semaphore semaphore;<br><br>    public MicrowaveOvenPool(int size,@NotNull List&lt;MicrowaveOven&gt; microwaveOvens) {<br>        this.microwaveOvens = new Vector&lt;&gt;(microwaveOvens);<br>        this.semaphore = new Semaphore(size);<br>    }<br>    public Food exec(Function&lt;MicrowaveOven, Food&gt; func) {<br>        MicrowaveOven microwaveOven = null;<br>        try{<br>            semaphore.acquire();<br>            microwaveOven = microwaveOvens.remove(0);<br>            return func.apply(microwaveOven);<br>        }catch (InterruptedException e) {<br>            e.printStackTrace();<br>        } finally {<br>            microwaveOvens.add(microwaveOven);<br>            semaphore.release();<br>        }<br>        return null;<br>    }<br><br>}<br></div>
                            <span class="time">2019-04-08</span>
                            <div class="reply">
                                <div class="reply-hd"><i class="iconfont"></i> <span class="reply-username">作者回复</span></div>
                                <p class="reply-content">👍</p>
                                <p class="reply-time">2019-04-09</p></div>
                        </div>
                    </li><li data-v-87ffcada="" class="comment-item">
                        <img src="https://static001.geekbang.org/account/avatar/00/0f/e7/56/c72997f3.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">缪文@有赞</span>
                                <div class="control"><!----> <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span class="like-count">2</span></a></div>
                            </div>
                            <div class="bd comment-content">这个限流器实际上限的是并发量，也就是同时允许多少个请求通过，如果限制每秒请求数，不是这个实现的吧</div>
                            <span class="time">2019-04-06</span>
                            <div class="reply">
                                <div class="reply-hd"><i class="iconfont"></i> <span class="reply-username">作者回复</span></div>
                                <p class="reply-content">后面会介绍guava的限流器</p>
                                <p class="reply-time">2019-04-06</p></div>
                        </div>
                    </li><li data-v-87ffcada="" class="comment-item">
                        <img src="https://static001.geekbang.org/account/avatar/00/10/ce/ab/e9d7811f.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">shawn</span>
                                <div class="control"><!----> <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span class="like-count">2</span></a></div>
                            </div>
                            <div class="bd comment-content">老师能否把课程所有的完整代码放到github上，这样我们学起来更方便。包括全面几章的也发下，因为有时候根据您的代码，我没法运行</div>
                            <span class="time">2019-04-04</span>
                            
                        </div>
                    </li><li data-v-87ffcada="" class="comment-item">
                        <img src="https://static001.geekbang.org/account/avatar/00/12/61/94/713b38ef.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">小和尚笨南北</span>
                                <div class="control"><!----> <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span class="like-count">2</span></a></div>
                            </div>
                            <div class="bd comment-content">semaphore底层通过AQS实现，AQS内部通过一个volatile变量间接实现同步。<br>根据happen-before原则的volatile规则和传递性规则。使用arraylist也不会发生线程安全问题。</div>
                            <span class="time">2019-04-04</span>
                            <div class="reply">
                                <div class="reply-hd"><i class="iconfont"></i> <span class="reply-username">作者回复</span></div>
                                <p class="reply-content">不可以，有多个线程进入临界区</p>
                                <p class="reply-time">2019-04-05</p></div>
                        </div>
                    </li><li data-v-87ffcada="" class="comment-item">
                        <img src="https://static001.geekbang.org/account/avatar/00/14/4d/03/01c5de8f.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">Mr Q.</span>
                                <div class="control"><!----> <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span class="like-count">1</span></a></div>
                            </div>
                            <div class="bd comment-content">创建对象池的时候都是添加的同一个对象。</div>
                            <span class="time">2019-05-17</span>
                            
                        </div>
                    </li><li data-v-87ffcada="" class="comment-item">
                        <img src="https://static001.geekbang.org/account/avatar/00/16/01/e7/091804b7.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">长眉_张永</span>
                                <div class="control"><!----> <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span class="like-count">1</span></a></div>
                            </div>
                            <div class="bd comment-content">对于进入的多个线程资源之间，如果有公用的信息的话，是否还需要加锁操作呢？</div>
                            <span class="time">2019-04-09</span>
                            <div class="reply">
                                <div class="reply-hd"><i class="iconfont"></i> <span class="reply-username">作者回复</span></div>
                                <p class="reply-content">需要</p>
                                <p class="reply-time">2019-04-09</p></div>
                        </div>
                    </li><li data-v-87ffcada="" class="comment-item">
                        <img src="https://static001.geekbang.org/account/avatar/00/0f/b2/c5/6ae0be56.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">木偶人King</span>
                                <div class="control"><!----> <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span class="like-count">1</span></a></div>
                            </div>
                            <div class="bd comment-content">ObjPool(int size, T t){<br>    pool = new Vector&lt;T&gt;(){};<br>    for(int i=0; i&lt;size; i++){<br>      pool.add(t);<br>    }<br>    sem = new Semaphore(size);<br>  }<br> //--------------------------------<br><br>老师这里pool.add(t)  一直循环添加的是同一个引用对象。没太明白。 为什么不是添加不同的t </div>
                            <span class="time">2019-04-09</span>
                            <div class="reply">
                                <div class="reply-hd"><i class="iconfont"></i> <span class="reply-username">作者回复</span></div>
                                <p class="reply-content">实际项目中一定是不同的</p>
                                <p class="reply-time">2019-04-09</p></div>
                        </div>
                    </li><li data-v-87ffcada="" class="comment-item">
                        <img src="https://static001.geekbang.org/account/avatar/00/11/15/69/fc60d1f4.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">陈华应</span>
                                <div class="control"><!----> <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span class="like-count">1</span></a></div>
                            </div>
                            <div class="bd comment-content">不可以，临界区会有多个线程并发执行</div>
                            <span class="time">2019-04-06</span>
                            
                        </div>
                    </li><li data-v-87ffcada="" class="comment-item">
                        <img src="https://static001.geekbang.org/account/avatar/00/12/7b/57/a9b04544.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">QQ怪</span>
                                <div class="control"><!----> <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span class="like-count">1</span></a></div>
                            </div>
                            <div class="bd comment-content">用初始化为1的Semaphore和管程来单单控制线程安全，哪个更有优势？为啥java不直接用信号量来实现互斥?</div>
                            <span class="time">2019-04-05</span>
                            <div class="reply">
                                <div class="reply-hd"><i class="iconfont"></i> <span class="reply-username">作者回复</span></div>
                                <p class="reply-content">如果仅仅是为了互斥，都可以。</p>
                                <p class="reply-time">2019-04-05</p></div>
                        </div>
                    </li><li data-v-87ffcada="" class="comment-item">
                        <img src="https://static001.geekbang.org/account/avatar/00/12/8a/f3/7c89d00e.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">Presley</span>
                                <div class="control"><!----> <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span class="like-count">1</span></a></div>
                            </div>
                            <div class="bd comment-content">进入临界区的N个线程不安全。add/remove都是不安全的。拿remove举例, ArrayList remove()源码：<br>public E remove(int index) {<br>        rangeCheck(index);<br><br>        modCount++;<br>       <br>        // 假设连个线程 t1,t2都执行到这一步，t1 让出cpu,t2执行<br>        E oldValue = elementData(index);<br>        // 到这步,t1继续执行，这时t1,t2拿到的oldValue是一样的，两个线程能拿到同一个对象，明显线程不安全啊<br><br>        int numMoved = size - index - 1;<br>        if (numMoved &gt; 0)<br>            System.arraycopy(elementData, index+1, elementData, index,<br>                             numMoved);<br>        elementData[--size] = null; // clear to let GC do its work<br><br>        return oldValue;<br>    }<br></div>
                            <span class="time">2019-04-04</span>
                            <div class="reply">
                                <div class="reply-hd"><i class="iconfont"></i> <span class="reply-username">作者回复</span></div>
                                <p class="reply-content">👍👍</p>
                                <p class="reply-time">2019-04-05</p></div>
                        </div>
                    </li><li data-v-87ffcada="" class="comment-item">
                        <img src="https://static001.geekbang.org/account/avatar/00/12/4d/87/57236a2d.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">榣山樵客™</span>
                                <div class="control"><!----> <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span class="like-count">1</span></a></div>
                            </div>
                            <div class="bd comment-content">换ArrayList是不行的，临界区内可能存在多个线程来执行remove操作，出现不可预知的后果。<br><br>对于chaos同学说return之前释放的问题，我觉得可以这么理解：return的是执行后的结果，而不是“执行”。所以顺序应该是这样的：1acquire；2apply；3finally release；4return2的结果</div>
                            <span class="time">2019-04-04</span>
                            <div class="reply">
                                <div class="reply-hd"><i class="iconfont"></i> <span class="reply-username">作者回复</span></div>
                                <p class="reply-content">是的，感谢回复的这么详细！！！</p>
                                <p class="reply-time">2019-04-04</p></div>
                        </div>
                    </li><li data-v-87ffcada="" class="comment-item">
                        <img src="https://static001.geekbang.org/account/avatar/00/11/ac/ef/8336bd81.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">crazypokerk</span>
                                <div class="control"><!----> <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span class="like-count">1</span></a></div>
                            </div>
                            <div class="bd comment-content">老师，那个计数器中得s.acquire()是需要捕获异常的。<br>static int count;<br>    static final Semaphore s = new Semaphore(1);<br><br>    static void addOne() throws InterruptedException {<br>        s.acquire();<br>        try {<br>            count += 1;<br>        }finally {<br>            s.release();<br>        }<br>    }</div>
                            <span class="time">2019-04-04</span>
                            <div class="reply">
                                <div class="reply-hd"><i class="iconfont"></i> <span class="reply-username">作者回复</span></div>
                                <p class="reply-content">异常都被我省略了，这样代码更能专注的表达问题，如果你本地实验，加上就可以了。手机屏幕太小，折行后行数太多，看到后面忘了前面，所以我尽讲精炼代码<br></p>
                                <p class="reply-time">2019-04-05</p></div>
                        </div>
                    </li><li data-v-87ffcada="" class="comment-item">
                        <img src="https://static001.geekbang.org/account/avatar/00/10/c8/6a/ab820630.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">疯狂埃里克</span>
                                <div class="control"><!----> <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span class="like-count">0</span></a></div>
                            </div>
                            <div class="bd comment-content">针对任何一个key的写入都有全局的写锁，这不合适吧？如果想给每个key建立自己的锁怎么做呢？</div>
                            <span class="time">2019-05-15</span>
                            
                        </div>
                    </li><li data-v-87ffcada="" class="comment-item">
                        <img src="https://static001.geekbang.org/account/avatar/00/13/0d/ac/09678490.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">谢特</span>
                                <div class="control"><!----> <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span class="like-count">0</span></a></div>
                            </div>
                            <div class="bd comment-content">为什么都是小于0</div>
                            <span class="time">2019-05-09</span>
                            
                        </div>
                    </li><li data-v-87ffcada="" class="comment-item">
                        <img src="https://static001.geekbang.org/account/avatar/00/13/0d/ac/09678490.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">谢特</span>
                                <div class="control"><!----> <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span class="like-count">0</span></a></div>
                            </div>
                            <div class="bd comment-content">为什么都是小于0</div>
                            <span class="time">2019-05-08</span>
                            
                        </div>
                    </li><li data-v-87ffcada="" class="comment-item">
                        <img src="" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">ycfHH</span>
                                <div class="control"><!----> <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span class="like-count">0</span></a></div>
                            </div>
                            <div class="bd comment-content">ObjPool初始化size大于1时用ArrayList就会出现线程安全问题，多个线程同时对ArrayList进行操作了。</div>
                            <span class="time">2019-05-06</span>
                            
                        </div>
                    </li><li data-v-87ffcada="" class="comment-item">
                        <img src="https://static001.geekbang.org/account/avatar/00/0f/ae/00/025f37e7.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">xuery</span>
                                <div class="control"><!----> <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span class="like-count">0</span></a></div>
                            </div>
                            <div class="bd comment-content">信号量计数器设置为1，则可以作为互斥锁使用；至于实现阻塞队列中的condition，现在还没有思路。<br>不能用ArrayList，使用信号量会有多个线程同时进入到pool.remove(0)中，ArrayList的remove方法显然不是线程安全的</div>
                            <span class="time">2019-04-29</span>
                            
                        </div>
                    </li><li data-v-87ffcada="" class="comment-item">
                        <img src="http://thirdwx.qlogo.cn/mmopen/vi_32/UfqEYrR3cQXUhPEibnXD3kPSc8f0ibR4bdz6JnibjOBibfcxWrkVlz4iaCAAutOSotiaP2ROYX5esYfhAB3vj4avnYqQ/132" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">Geek_53bccf</span>
                                <div class="control"><!----> <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span class="like-count">0</span></a></div>
                            </div>
                            <div class="bd comment-content">down方法里面当计数器小于零的时候 就阻塞线程，如果有两个线程进入阻塞那计数器就是-2当调用up方法的一次的时候，此时计数器就为-1那依旧小于零调用down方法依旧阻塞 这样的话岂不是有问题。明明一个线程调用了up方法就是释放信号量 另一个线程获得这个信号量的时候发现它的计数器是-1依旧小于零则进入阻塞状态 </div>
                            <span class="time">2019-04-24</span>
                            
                        </div>
                    </li><li data-v-87ffcada="" class="comment-item">
                        <img src="https://static001.geekbang.org/account/avatar/00/0f/db/80/6b7629d7.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">roaming</span>
                                <div class="control"><!----> <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span class="like-count">0</span></a></div>
                            </div>
                            <div class="bd comment-content">老师，LockSupport用的也是信号量模型，对吗？专栏里没有提到这个工具类，是不常用吗？</div>
                            <span class="time">2019-04-18</span>
                            <div class="reply">
                                <div class="reply-hd"><i class="iconfont"></i> <span class="reply-username">作者回复</span></div>
                                <p class="reply-content">信号量模型是用它实现的，太底层的东西都不是给普通人用的<br></p>
                                <p class="reply-time">2019-04-19</p></div>
                        </div>
                    </li><li data-v-87ffcada="" class="comment-item">
                        <img src="https://static001.geekbang.org/account/avatar/00/10/64/86/6b593cb9.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">Zach_</span>
                                <div class="control"><!----> <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span class="like-count">0</span></a></div>
                            </div>
                            <div class="bd comment-content">我只想说，真的讲的很赞！<br><br>清明节后到现在一直在忙其他的，今天早上才补了一节，真的很赞！ <br><br>谢谢老师解开了我一直以来的疑惑，谢谢您！</div>
                            <span class="time">2019-04-11</span>
                            <div class="reply">
                                <div class="reply-hd"><i class="iconfont"></i> <span class="reply-username">作者回复</span></div>
                                <p class="reply-content">同样感谢支持！！</p>
                                <p class="reply-time">2019-04-12</p></div>
                        </div>
                    </li><li data-v-87ffcada="" class="comment-item">
                        <img src="" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">Juc</span>
                                <div class="control"><!----> <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span class="like-count">0</span></a></div>
                            </div>
                            <div class="bd comment-content">老师可以公布一下完整的代码到github上吗？</div>
                            <span class="time">2019-04-10</span>
                            
                        </div>
                    </li><li data-v-87ffcada="" class="comment-item">
                        <img src="https://static001.geekbang.org/account/avatar/00/0f/fe/b5/df0f658f.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">ken</span>
                                <div class="control"><!----> <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span class="like-count">0</span></a></div>
                            </div>
                            <div class="bd comment-content">信号量提供的方法是安全的，使用信号量的方法支持多个线程进入临界区，此时临界区也是一个多线线程的场景所以需要使用Vector操作list。</div>
                            <span class="time">2019-04-08</span>
                            
                        </div>
                    </li><li data-v-87ffcada="" class="comment-item">
                        <img src="https://static001.geekbang.org/account/avatar/00/16/92/8f/0378e325.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">心中无剑</span>
                                <div class="control"><!----> <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span class="like-count">0</span></a></div>
                            </div>
                            <div class="bd comment-content">老师的池子例子，创建对象池的时候，泛型Long,String,这一段报错啊</div>
                            <span class="time">2019-04-08</span>
                            
                        </div>
                    </li><li data-v-87ffcada="" class="comment-item">
                        <img src="" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">zero</span>
                                <div class="control"><!----> <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span class="like-count">0</span></a></div>
                            </div>
                            <div class="bd comment-content">ArrayList的remove和add方法不是线程安全的，Vector可以保证add、remove是线程安全。所在对象池的例子中，如果使用ArrayList替换掉Vector的话，在由多个线程从线程池获取对象是会出现并发问题。</div>
                            <span class="time">2019-04-06</span>
                            
                        </div>
                    </li><li data-v-87ffcada="" class="comment-item">
                        <img src="https://static001.geekbang.org/account/avatar/00/10/d9/93/098e5ef5.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">海鸿</span>
                                <div class="control"><!----> <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span class="like-count">0</span></a></div>
                            </div>
                            <div class="bd comment-content">Semaphore 可以允许多个线程访问一个临界区。像池资源那样，进入之后还是得控制资源的获取啊，不然还是会产生并发问题啊，不是吗？</div>
                            <span class="time">2019-04-05</span>
                            <div class="reply">
                                <div class="reply-hd"><i class="iconfont"></i> <span class="reply-username">作者回复</span></div>
                                <p class="reply-content">是😂</p>
                                <p class="reply-time">2019-04-08</p></div>
                        </div>
                    </li><li data-v-87ffcada="" class="comment-item">
                        <img src="https://static001.geekbang.org/account/avatar/00/0f/76/23/31e5e984.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">空知</span>
                                <div class="control"><!----> <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span class="like-count">0</span></a></div>
                            </div>
                            <div class="bd comment-content">不能 arraylist的remove add操作没有加锁, 信号量允许多个线程同时操作,可能俩线程操作 remove操作同一个对象</div>
                            <span class="time">2019-04-05</span>
                            
                        </div>
                    </li><li data-v-87ffcada="" class="comment-item">
                        <img src="https://static001.geekbang.org/account/avatar/00/10/99/c9/a7c77746.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">冰激凌的眼泪</span>
                                <div class="control"><!----> <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span class="like-count">0</span></a></div>
                            </div>
                            <div class="bd comment-content">sem可以保障一类资源最多有多少并发使用，但是资源的并发安全需要单独考虑</div>
                            <span class="time">2019-04-05</span>
                            
                        </div>
                    </li><li data-v-87ffcada="" class="comment-item">
                        <img src="https://wx.qlogo.cn/mmopen/vi_32/DYAIOgq83eqLcWH3mSPmhjrs1aGL4b3TqI7xDqWWibM4nYFrRlp0z7FNSWaJz0mqovrgIA7ibmrPt8zRScSfRaqQ/132" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">易儿易</span>
                                <div class="control"><!----> <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span class="like-count">0</span></a></div>
                            </div>
                            <div class="bd comment-content">计数器值小于0，线程会阻塞并进入队列，如果计数器值大于初始值呢？我代码测试了一下，执行起来没有什么问题，但总觉得有些不太靠谱……请问老师：信号量的使用规范是不是得要求acquire()release()必须成对出现并保证release()顺利执行？否则独立的acquire()就能使计数器值大于初始值，可能会引入BUG（导致线程数多余池中限定的数量），不过这个也有好处，貌似也可以起到动态调整semaphore初始值的作用。老师我没有并发开发经验，只是根据专栏内有限内容思考，不知道我的想法对不对，有没有实际意义。请指教~</div>
                            <span class="time">2019-04-05</span>
                            <div class="reply">
                                <div class="reply-hd"><i class="iconfont"></i> <span class="reply-username">作者回复</span></div>
                                <p class="reply-content">必须成对出现，所以才用try finally </p>
                                <p class="reply-time">2019-04-05</p></div>
                        </div>
                    </li><li data-v-87ffcada="" class="comment-item">
                        <img src="https://static001.geekbang.org/account/avatar/00/0f/b4/3b/a1f7e3a4.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">ZOU志伟</span>
                                <div class="control"><!----> <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span class="like-count">0</span></a></div>
                            </div>
                            <div class="bd comment-content">明白了，用信号量比管程的优势是，信号量不用再另外判断对象池的大小，谢谢老师👍 </div>
                            <span class="time">2019-04-05</span>
                            
                        </div>
                    </li><li data-v-87ffcada="" class="comment-item">
                        <img src="https://wx.qlogo.cn/mmopen/vi_32/DYAIOgq83eqLcWH3mSPmhjrs1aGL4b3TqI7xDqWWibM4nYFrRlp0z7FNSWaJz0mqovrgIA7ibmrPt8zRScSfRaqQ/132" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">易儿易</span>
                                <div class="control"><!----> <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span class="like-count">0</span></a></div>
                            </div>
                            <div class="bd comment-content">限流器，平时自己开发的时候，是不是简单使用阻塞队列就可以了呢？和信号量比起来有什么差别吗？</div>
                            <span class="time">2019-04-05</span>
                            <div class="reply">
                                <div class="reply-hd"><i class="iconfont"></i> <span class="reply-username">作者回复</span></div>
                                <p class="reply-content">条条大路通罗马，都可以。</p>
                                <p class="reply-time">2019-04-05</p></div>
                        </div>
                    </li><li data-v-87ffcada="" class="comment-item">
                        <img src="https://static001.geekbang.org/account/avatar/00/10/e0/24/4529f2a4.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">WP</span>
                                <div class="control"><!----> <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span class="like-count">0</span></a></div>
                            </div>
                            <div class="bd comment-content">王老师的这个专栏让我受益匪浅啊，收获多多，哈哈，期待后面的文章~~</div>
                            <span class="time">2019-04-05</span>
                            
                        </div>
                    </li><li data-v-87ffcada="" class="comment-item">
                        <img src="https://static001.geekbang.org/account/avatar/00/12/8a/f3/7c89d00e.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">Presley</span>
                                <div class="control"><!----> <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span class="like-count">0</span></a></div>
                            </div>
                            <div class="bd comment-content">需要保证10个线程的线程安全</div>
                            <span class="time">2019-04-04</span>
                            
                        </div>
                    </li><li data-v-87ffcada="" class="comment-item">
                        <img src="https://static001.geekbang.org/account/avatar/00/10/e0/24/4529f2a4.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">WP</span>
                                <div class="control"><!----> <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span class="like-count">0</span></a></div>
                            </div>
                            <div class="bd comment-content">我好像知道原因了   finally里面的回收和计数器顺序调整下就对了   我错了~~</div>
                            <span class="time">2019-04-04</span>
                            <div class="reply">
                                <div class="reply-hd"><i class="iconfont"></i> <span class="reply-username">作者回复</span></div>
                                <p class="reply-content">并发程序就这样，一不小心就错，谁都免不了犯这种错误😂</p>
                                <p class="reply-time">2019-04-04</p></div>
                        </div>
                    </li><li data-v-87ffcada="" class="comment-item">
                        <img src="https://static001.geekbang.org/account/avatar/00/10/e0/24/4529f2a4.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">WP</span>
                                <div class="control"><!----> <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span class="like-count">0</span></a></div>
                            </div>
                            <div class="bd comment-content">main里面的循环创建线程数量10没问题    设定大一些就会遇到空指针</div>
                            <span class="time">2019-04-04</span>
                            
                        </div>
                    </li><li data-v-87ffcada="" class="comment-item">
                        <img src="https://static001.geekbang.org/account/avatar/00/10/e0/24/4529f2a4.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">WP</span>
                                <div class="control"><!----> <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span class="like-count">0</span></a></div>
                            </div>
                            <div class="bd comment-content">package com.zzu.concurrent;<br>import java.util.List;<br>import java.util.Vector;<br>import java.util.concurrent.Semaphore;<br>import java.util.function.Function;<br>/**<br> * @Corp<br> * @Description: 练习多线程<br> * @Author hotwater<br> * @Date 2019年04月04日  17:47<br> * @Version Version2.0.0<br> */<br>public class ConcurrentPool&lt;T, R&gt; {<br>// 核心代码：实现一个对象池的限流器<br>    //对象池子<br>      volatile List&lt;T&gt; pool = new Vector&lt;T&gt;();<br>    //限流器<br>    final Semaphore semaphore;<br><br><br>    public ConcurrentPool(int poolSize, T t) {<br>        //初始化对象池操作<br>        for (int x = 0; x &lt; poolSize; x++) {<br>            pool.add(t);<br>        }<br>        //初始化限流器<br>        this.semaphore = new Semaphore(poolSize);<br>    }<br><br>    //执行器<br>    R exec(Function&lt;T, R&gt; function) {<br>        T remove = null;<br>        try {<br><br>            //申请资源<br>            System.err.println("线程"+Thread.currentThread().getName()+"申请资源前池子大小："+pool.size());<br>            semaphore.acquire();<br>            //从池子中移除<br>            remove = pool.remove(0);<br>            System.err.println("线程"+Thread.currentThread().getName()+"申请资源后池子大小："+pool.size());<br>             return function.apply(remove);<br>        } catch (Exception e) {<br>            e.printStackTrace();<br>        } finally {<br>            //回收资源<br>            System.err.println("线程"+Thread.currentThread().getName()+"回收资源前池子大小："+pool.size());<br>            semaphore.release();<br>            pool.add(remove);<br>            System.err.println("线程"+Thread.currentThread().getName()+"回收资源后池子大小："+pool.size());<br>        }<br>        return null;<br>    }<br><br>    public static void main(String[] args) {<br>        ConcurrentPool&lt;Integer,String&gt;pool=new ConcurrentPool&lt;&gt;(10,2);<br>        for (int x=0;x&lt;10;x++) {<br>            new Thread(new Runnable() {<br>                @Override<br>                public void run() {<br>                   pool.exec(t-&gt;{<br>                        System.err.println(Thread.currentThread().getName()+"FUNCTION函数执行："+t);<br>                        return t.toString();<br>                    });<br>                }<br>            }).start();<br>        }<br>    }<br>}</div>
                            <span class="time">2019-04-04</span>
                            
                        </div>
                    </li><li data-v-87ffcada="" class="comment-item">
                        <img src="https://static001.geekbang.org/account/avatar/00/14/e1/ca/a41422f6.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">橘子</span>
                                <div class="control"><!----> <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span class="like-count">0</span></a></div>
                            </div>
                            <div class="bd comment-content">AQS也是用CAS实现的，信号量因为可以设置数量，所以一次会有多个线程操作list也就是原子性不能保证。</div>
                            <span class="time">2019-04-04</span>
                            
                        </div>
                    </li><li data-v-87ffcada="" class="comment-item">
                        <img src="https://static001.geekbang.org/account/avatar/00/10/e0/24/4529f2a4.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">WP</span>
                                <div class="control"><!----> <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span class="like-count">0</span></a></div>
                            </div>
                            <div class="bd comment-content">尝试跑更多线程会有空指针问题：<br>17行代码：t = pool.remove(0);<br>32行代码：return t.toString();<br>既然上文的16行代码 sem.acquire();获取不到信号量就会线程阻塞，那么为啥还会空指针呢，是我理解的问题么？</div>
                            <span class="time">2019-04-04</span>
                            <div class="reply">
                                <div class="reply-hd"><i class="iconfont"></i> <span class="reply-username">作者回复</span></div>
                                <p class="reply-content">最好把代码帖出来<br></p>
                                <p class="reply-time">2019-04-04</p></div>
                        </div>
                    </li><li data-v-87ffcada="" class="comment-item">
                        <img src="https://static001.geekbang.org/account/avatar/00/14/0c/23/0193e869.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">相信的力量</span>
                                <div class="control"><!----> <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span class="like-count">0</span></a></div>
                            </div>
                            <div class="bd comment-content">ArrayList的add和remove方法不是线程安全的，并发执行可能会出错。</div>
                            <span class="time">2019-04-04</span>
                            
                        </div>
                    </li><li data-v-87ffcada="" class="comment-item">
                        <img src="https://static001.geekbang.org/account/avatar/00/10/a0/da/4f50f1b2.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">Knight²º¹⁸</span>
                                <div class="control"><!----> <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span class="like-count">0</span></a></div>
                            </div>
                            <div class="bd comment-content">我最近也遇到了对象池的需求。但是我的场景是允许多个线程同时使用某一个对象，在特定的时间需要对象进行回收实际是使用新的对象进行替换，把旧的对象回收待下次使用；且回收的频率非常低，一天只回收一次）。没有打算使用读写锁，因为性能要求非常高。</div>
                            <span class="time">2019-04-04</span>
                            
                        </div>
                    </li><li data-v-87ffcada="" class="comment-item">
                        <img src="" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">liurh</span>
                                <div class="control"><!----> <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span class="like-count">0</span></a></div>
                            </div>
                            <div class="bd comment-content">不可以，多个线程同时进入临界区，remove方法可能会移除同一个对象</div>
                            <span class="time">2019-04-04</span>
                            <div class="reply">
                                <div class="reply-hd"><i class="iconfont"></i> <span class="reply-username">作者回复</span></div>
                                <p class="reply-content">👍👍<br></p>
                                <p class="reply-time">2019-04-04</p></div>
                        </div>
                    </li><li data-v-87ffcada="" class="comment-item">
                        <img src="https://static001.geekbang.org/account/avatar/00/16/8b/ec/dc03f5ad.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">张天屹</span>
                                <div class="control"><!----> <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span class="like-count">0</span></a></div>
                            </div>
                            <div class="bd comment-content">如果信号量初始化为1 就可以用ArrayList，因为这个时候exec相当于一个线程的临界区类似于互斥锁，但是现在初始化为10，也就意味着可能有多于一个线程同时在执行exec方法，也就意味着list.remove方法中可能发生线程切换，remove方法涉及size的判断肯定是有静态条件的，所以必须用vector保证remove操作的原子性</div>
                            <span class="time">2019-04-04</span>
                            <div class="reply">
                                <div class="reply-hd"><i class="iconfont"></i> <span class="reply-username">作者回复</span></div>
                                <p class="reply-content">👍👍👍<br></p>
                                <p class="reply-time">2019-04-04</p></div>
                        </div>
                    </li><li data-v-87ffcada="" class="comment-item">
                        <img src="https://static001.geekbang.org/account/avatar/00/11/09/98/b11c372b.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">鸠翱</span>
                                <div class="control"><!----> <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span class="like-count">0</span></a></div>
                            </div>
                            <div class="bd comment-content">看见评论区还有同学还在说由于happen-before，可以使用arraylist<br>果然还是没有搞懂可见性和并发安全的关系呢</div>
                            <span class="time">2019-04-04</span>
                            
                        </div>
                    </li><li data-v-87ffcada="" class="comment-item">
                        <img src="https://static001.geekbang.org/account/avatar/00/0f/4c/12/6d9493c3.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">rayjun</span>
                                <div class="control"><!----> <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span class="like-count">0</span></a></div>
                            </div>
                            <div class="bd comment-content">文中说的计数器和等待队列对外应该是不透明的吧</div>
                            <span class="time">2019-04-04</span>
                            
                        </div>
                    </li><li data-v-87ffcada="" class="comment-item">
                        <img src="https://static001.geekbang.org/account/avatar/00/16/0c/b0/26c0e53f.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">贺宇</span>
                                <div class="control"><!----> <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span class="like-count">0</span></a></div>
                            </div>
                            <div class="bd comment-content">虽然信号量的down和up都是原子操作，线程安全的，但是两个方法中间的操作不一定保证线程安全，所以这里还是要通过管程来保证线程安全。我觉得Vertor可以换成BlockingQueue,效率更高一点</div>
                            <span class="time">2019-04-04</span>
                            <div class="reply">
                                <div class="reply-hd"><i class="iconfont"></i> <span class="reply-username">作者回复</span></div>
                                <p class="reply-content">是的</p>
                                <p class="reply-time">2019-04-05</p></div>
                        </div>
                    </li><li data-v-87ffcada="" class="comment-item">
                        <img src="https://static001.geekbang.org/account/avatar/00/15/ef/29/5f0094ff.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">Chaos</span>
                                <div class="control"><!----> <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span class="like-count">0</span></a></div>
                            </div>
                            <div class="bd comment-content">finally 语句块是在 try 或者 catch 中的 return 语句之前执行的。<br> try {<br>      t = pool.remove(0);<br>      return func.apply(t);<br>    } finally {<br>      pool.add(t);<br>      sem.release();<br>    }<br>那回调函数没执行完，对象就被释放了，这点有点疑问？</div>
                            <span class="time">2019-04-04</span>
                            <div class="reply">
                                <div class="reply-hd"><i class="iconfont"></i> <span class="reply-username">作者回复</span></div>
                                <p class="reply-content">把return分成两行写是不是就理解了呢😂</p>
                                <p class="reply-time">2019-04-04</p></div>
                        </div>
                    </li><li data-v-87ffcada="" class="comment-item">
                        <img src="https://static001.geekbang.org/account/avatar/00/0f/b4/3b/a1f7e3a4.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">ZOU志伟</span>
                                <div class="control"><!----> <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span class="like-count">0</span></a></div>
                            </div>
                            <div class="bd comment-content">这个对象池用信号量实现比管程实现的优势在哪？拿对象的时候线程不是还是要互斥拿吗？</div>
                            <span class="time">2019-04-04</span>
                            <div class="reply">
                                <div class="reply-hd"><i class="iconfont"></i> <span class="reply-username">作者回复</span></div>
                                <p class="reply-content">用管程写一个，比较一下就知道了<br></p>
                                <p class="reply-time">2019-04-04</p></div>
                        </div>
                    </li><li data-v-87ffcada="" class="comment-item">
                        <img src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIBarfQrgZjEW8uUgvQckubEIFwNCJL93OygIgx3fCkObgRzSdo2baVWRd1C8mV6VDGKuoBFic4ZZA/132" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">xiyi</span>
                                <div class="control"><!----> <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span class="like-count">0</span></a></div>
                            </div>
                            <div class="bd comment-content">Arraylist 不行，存在线程安全问题，多线程并发删除可能导致两个线程使用一个对象！两个线程的remove操作没有happen-before的关系，没有满足传递性</div>
                            <span class="time">2019-04-04</span>
                            
                        </div>
                    </li><li data-v-87ffcada="" class="comment-item">
                        <img src="https://static001.geekbang.org/account/avatar/00/11/25/ea/ec869117.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">易水南风</span>
                                <div class="control"><!----> <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span class="like-count">0</span></a></div>
                            </div>
                            <div class="bd comment-content">老师以后会讲下信号量底层原理吗</div>
                            <span class="time">2019-04-04</span>
                            <div class="reply">
                                <div class="reply-hd"><i class="iconfont"></i> <span class="reply-username">作者回复</span></div>
                                <p class="reply-content">这个水平高的自己看源码吧</p>
                                <p class="reply-time">2019-04-04</p></div>
                        </div>
                    </li><li data-v-87ffcada="" class="comment-item">
                        <img src="https://static001.geekbang.org/account/avatar/00/12/e1/df/6e6a4c6b.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">kevin</span>
                                <div class="control"><!----> <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span class="like-count">0</span></a></div>
                            </div>
                            <div class="bd comment-content">对于课后题，队列已通过semaphore保护，可以使用ArrayList</div>
                            <span class="time">2019-04-04</span>
                            <div class="reply">
                                <div class="reply-hd"><i class="iconfont"></i> <span class="reply-username">作者回复</span></div>
                                <p class="reply-content">不可以，有多个线程进入临界区</p>
                                <p class="reply-time">2019-04-05</p></div>
                        </div>
                    </li><li data-v-87ffcada="" class="comment-item">
                        <img src="https://static001.geekbang.org/account/avatar/00/0f/48/ee/872ad07e.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">西西弗与卡夫卡</span>
                                <div class="control"><!----> <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span class="like-count">0</span></a></div>
                            </div>
                            <div class="bd comment-content">不可以使用ArrayList。如果限流N，那就相当于允许N个线程同时访问，而ArrayList不是线程安全</div>
                            <span class="time">2019-04-04</span>
                            <div class="reply">
                                <div class="reply-hd"><i class="iconfont"></i> <span class="reply-username">作者回复</span></div>
                                <p class="reply-content">👍<br></p>
                                <p class="reply-time">2019-04-04</p></div>
                        </div>
                    </li><li data-v-87ffcada="" class="comment-item">
                        <img src="https://static001.geekbang.org/account/avatar/00/11/a2/f3/aa504fa6.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">波波</span>
                                <div class="control"><!----> <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span class="like-count">0</span></a></div>
                            </div>
                            <div class="bd comment-content">评论区越来越少，我来水一下，讲的有难度，已经开始第二轮学习老师课程了。</div>
                            <span class="time">2019-04-04</span>
                            <div class="reply">
                                <div class="reply-hd"><i class="iconfont"></i> <span class="reply-username">作者回复</span></div>
                                <p class="reply-content">并发包里东西太多，只能高度概括了😂</p>
                                <p class="reply-time">2019-04-04</p></div>
                        </div>
                    </li><li data-v-87ffcada="" class="comment-item">
                        <img src="https://static001.geekbang.org/account/avatar/00/14/3a/f8/9ef3deb5.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">朱晋君</span>
                                <div class="control"><!----> <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span class="like-count">0</span></a></div>
                            </div>
                            <div class="bd comment-content">已经用信号量做了控制，用arraylist也是可以的</div>
                            <span class="time">2019-04-04</span>
                            <div class="reply">
                                <div class="reply-hd"><i class="iconfont"></i> <span class="reply-username">作者回复</span></div>
                                <p class="reply-content">不可以，有多个线程进入临界区</p>
                                <p class="reply-time">2019-04-05</p></div>
                        </div>
                    </li><li data-v-87ffcada="" class="comment-item">
                        <img src="https://static001.geekbang.org/account/avatar/00/10/4f/78/c3d8ecb0.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">undifined</span>
                                <div class="control"><!----> <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span class="like-count">0</span></a></div>
                            </div>
                            <div class="bd comment-content">不可以，如果换成 ArrayList，即使有Semaphore，也有可能造成两个线程拿到同一个对象</div>
                            <span class="time">2019-04-04</span>
                            
                        </div>
                    </li><li data-v-87ffcada="" class="comment-item">
                        <img src="https://static001.geekbang.org/account/avatar/00/11/0b/78/22410c47.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">魏春河</span>
                                <div class="control"><!----> <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span class="like-count">0</span></a></div>
                            </div>
                            <div class="bd comment-content">老师你好，acquire方法是如何保证是一个原子操作的呢？</div>
                            <span class="time">2019-04-04</span>
                            
                        </div>
                    </li><li data-v-87ffcada="" class="comment-item">
                        <img src="https://static001.geekbang.org/account/avatar/00/12/ea/05/c0d8014d.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">刘章周</span>
                                <div class="control"><!----> <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span class="like-count">0</span></a></div>
                            </div>
                            <div class="bd comment-content">多个线程执行remove操作，使用arrayList会导致线程安全问题，如果信号量是1,就没有线程安全问题。</div>
                            <span class="time">2019-04-04</span>
                            
                        </div>
                    </li><li data-v-87ffcada="" class="comment-item">
                        <img src="https://static001.geekbang.org/account/avatar/00/13/72/7f/5da093c5.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">Binggle</span>
                                <div class="control"><!----> <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span class="like-count">0</span></a></div>
                            </div>
                            <div class="bd comment-content">信号量只能保证N个线程来对象池中取对象，而这 N 个线程操作对象池还是需要保证安全的，所有 vector 可以而 arraylist 不行。</div>
                            <span class="time">2019-04-04</span>
                            
                        </div>
                    </li><li data-v-87ffcada="" class="comment-item">
                        <img src="https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKR3ibELhjgVicCNShZCBwvaDxibnzibggG4wUzVkS2mkDxUBZyIs87nDEdJ7PiahJBVoZcuhQ84RxAziag/132" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">周治慧</span>
                                <div class="control"><!----> <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span class="like-count">0</span></a></div>
                            </div>
                            <div class="bd comment-content">不能换，当多个线程同时进入信号量获取的临界点点时，同时执行remove方法是现场不安全的同理add</div>
                            <span class="time">2019-04-04</span>
                            
                        </div>
                    </li><li data-v-87ffcada="" class="comment-item">
                        <img src="https://static001.geekbang.org/account/avatar/00/10/06/df/60126ff3.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">0bug</span>
                                <div class="control"><!----> <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span class="like-count">0</span></a></div>
                            </div>
                            <div class="bd comment-content">只有size 等于1的时候可以用arraylist</div>
                            <span class="time">2019-04-04</span>
                            
                        </div>
                    </li><li data-v-87ffcada="" class="comment-item">
                        <img src="https://static001.geekbang.org/account/avatar/00/10/01/37/58650ade.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">高源</span>
                                <div class="control"><!----> <a href="javascript:;" class="btn-praise"><i class="iconfont"></i> <span class="like-count">0</span></a></div>
                            </div>
                            <div class="bd comment-content">Arraylist不是线程同步的，造成多个线程进入导致数据错误</div>
                            <span class="time">2019-04-04</span>
                            
                        </div>
                    </li></ul>
            </div>
        </div> <!----> <!----></div>
</div>
<link rel="dns-prefetch" href="//cdn.mathjax.org">
<script type="text/x-mathjax-config">MathJax.Hub.Config({
        showProcessingMessages: false,
        messageStyle: "none",
        tex2jax: {
          inlineMath: [['$','$'], ['\\(','\\)']],
          displayMath: [ ["$$","$$"] ],
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code', 'a']
        }
      });
      MathJax.Hub.Register.MessageHook("End Process", function (message) {
        var eve = new Event('mathjaxfini')
        window.dispatchEvent(eve)
      })




</script>

</body>